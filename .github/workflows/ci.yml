# .github/workflows/ci.yml

# Name of your pipeline (shows up on GitHub)
name: Todo App CI/CD Pipeline

# TRIGGER: When should this pipeline run?
# Answer: Every time anyone pushes code to the main branch
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# JOBS: What should the pipeline actually do?
jobs:

  # JOB 1: Test the code
  test:
    name: Run Tests
    runs-on: ubuntu-latest    # Use a fresh Ubuntu machine in the cloud

    steps:
      # Step 1: Download your code onto the cloud machine
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Install Node.js on the cloud machine
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'        # Cache npm packages to speed up future runs

      # Step 3: Install your app's dependencies (express, jest, supertest)
      - name: Install dependencies
        run: npm install

      # Step 4: Run your 6 tests!
      - name: Run tests
        run: npm test

  # JOB 2: Only runs if JOB 1 (tests) passed ‚úÖ
  build:
    name: Build App
    runs-on: ubuntu-latest
    needs: test               # ‚Üê This means "wait for test job to pass first"

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm install      # Step: Verify app starts correctly
      - name: Verify app starts
        run: |
          node server.js &
          sleep 3
          curl http://localhost:3000 && echo "‚úÖ App is running!"
          kill %1

      - name: Pipeline complete
        run: echo "üéâ All checks passed! App is ready to deploy."
```


